CREATE TABLE READERS_AUD (
	EVENT_ID INT(11) NOT NULL AUTO_INCREMENT,
    EVENT_DATE DATETIME NOT NULL,
    EVENT_TYPE VARCHAR(20) DEFAULT NULL,
    READER_ID INT(11) NOT NULL,
    OLD_READER_FIRSTNAME VARCHAR(255),
    NEW_READER_FIRSTNAME VARCHAR(255),
    OLD_READER_LASTNAME VARCHAR(255),
    NEW_READER_LASTNAME VARCHAR(255),
    OLD_READER_PESELID VARCHAR(11),
    NEW_READER_PESELID VARCHAR(11),
    OLD_READER_VIPLEVEL VARCHAR(20),
    NEW_READER_VIPLEVEL VARCHAR(20),
    PRIMARY KEY (EVENT_ID)
    );



DELIMITER $$

CREATE TRIGGER READERS_INSERT AFTER INSERT ON READERS
FOR EACH ROW
BEGIN
	INSERT INTO READERS_AUD (EVENT_DATE, EVENT_TYPE, READER_ID,
		NEW_READER_FIRSTNAME, NEW_READER_LASTNAME, NEW_READER_PESELID, NEW_READER_VIPLEVEL)
	VALUES (CURTIME(), "INSERT", NEW.READER_ID,
		NEW.FIRSTNAME, NEW.LASTNAME, NEW.PESELID, NEW.VIP_LEVEL);
END $$

DELIMITER ;



DELIMITER $$

CREATE TRIGGER READERS_DELETE AFTER DELETE ON READERS
FOR EACH ROW
BEGIN
	INSERT INTO READERS_AUD (EVENT_DATE, EVENT_TYPE, READER_ID)
			VALUES (CURTIME(), "DELETE", OLD.READER_ID);
END $$

DELIMITER ;



DELIMITER $$

CREATE TRIGGER READERS_UPDATE AFTER UPDATE ON READERS
FOR EACH ROW
BEGIN
	INSERT INTO READERS_AUD (EVENT_DATE, EVENT_TYPE, READER_ID, NEW_READER_FIRSTNAME,
    NEW_READER_LASTNAME, NEW_READER_PESELID, NEW_READER_VIPLEVEL, OLD_READER_FIRSTNAME,
    OLD_READER_LASTNAME, OLD_READER_PESELID, OLD_READER_VIPLEVEL)
    VALUES (CURTIME(), "UPDATE", OLD.READER_ID, NEW.FIRSTNAME, NEW.LASTNAME,
    NEW.PESELID, NEW.VIP_LEVEL, OLD.FIRSTNAME, OLD.LASTNAME,
    OLD.PESELID, OLD.VIP_LEVEL);
END $$

DELIMITER ;


